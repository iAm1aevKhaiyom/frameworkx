import { parse } from "@microframework/parser"

describe("parse queries", () => {
  test("simple definitions", () => {
    const result = parse(__dirname + "/simple-definitions-app.ts")
    // console.log(JSON.stringify(result, undefined, 2))
    expect(result).toEqual({
      "@type": "ApplicationTypeMetadata",
      name: "App",
      description: "",
      actions: [],
      models: [
        {
          "@type": "TypeMetadata",
          kind: "object",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [
            {
              "@type": "TypeMetadata",
              kind: "number",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "id",
            },
            {
              "@type": "TypeMetadata",
              kind: "string",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "name",
              args: {
                "@type": "TypeMetadata",
                kind: "object",
                array: false,
                nullable: false,
                canBeUndefined: false,
                properties: [
                  {
                    "@type": "TypeMetadata",
                    kind: "string",
                    array: false,
                    nullable: false,
                    canBeUndefined: false,
                    properties: [],
                    propertyName: "keyword",
                  },
                ],
              },
            },
          ],
          modelName: "PostModel",
          description: "Type for a PostModel.",
        },
        {
          "@type": "TypeMetadata",
          kind: "object",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [
            {
              "@type": "TypeMetadata",
              kind: "number",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "id",
            },
            {
              "@type": "TypeMetadata",
              kind: "string",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "name",
            },
          ],
          typeName: "CategoryType",
          description: "Dummy type.",
        },
      ],
      inputs: [
        {
          "@type": "TypeMetadata",
          kind: "object",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [
            {
              "@type": "TypeMetadata",
              kind: "number",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "id",
            },
            {
              "@type": "TypeMetadata",
              kind: "string",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "name",
            },
          ],
          typeName: "PostInput",
          description: "Simple input for testing purposes.",
        },
        {
          "@type": "TypeMetadata",
          kind: "object",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [
            {
              "@type": "TypeMetadata",
              kind: "number",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "id",
            },
            {
              "@type": "TypeMetadata",
              kind: "string",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "name",
            },
          ],
          typeName: "PostFilterInput",
          description: "Simple input for testing purposes.",
        },
        {
          "@type": "TypeMetadata",
          kind: "object",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [
            {
              "@type": "TypeMetadata",
              kind: "number",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "id",
            },
            {
              "@type": "TypeMetadata",
              kind: "string",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "name",
            },
          ],
          typeName: "CategoryInput",
          description: "Simple input for testing purposes.",
        },
      ],
      queries: [
        {
          "@type": "TypeMetadata",
          kind: "model",
          array: true,
          nullable: false,
          canBeUndefined: false,
          properties: [],
          modelName: "PostModel",
          propertyName: "posts",
          description: "",
          args: {
            "@type": "TypeMetadata",
            kind: "object",
            array: false,
            nullable: false,
            canBeUndefined: false,
            properties: [
              {
                "@type": "TypeMetadata",
                kind: "number",
                array: false,
                nullable: false,
                canBeUndefined: false,
                properties: [],
                propertyName: "id",
              },
              {
                "@type": "TypeMetadata",
                kind: "string",
                array: false,
                nullable: false,
                canBeUndefined: false,
                properties: [],
                propertyName: "name",
              },
            ],
            typeName: "PostFilterInput",
            description: "Simple input for testing purposes.",
          },
        },
        {
          "@type": "TypeMetadata",
          kind: "model",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [],
          modelName: "PostModel",
          propertyName: "post",
          description: "",
          args: {
            "@type": "TypeMetadata",
            kind: "object",
            array: false,
            nullable: false,
            canBeUndefined: false,
            properties: [
              {
                "@type": "TypeMetadata",
                kind: "number",
                array: false,
                nullable: false,
                canBeUndefined: false,
                properties: [],
                propertyName: "id",
              },
            ],
          },
        },
        {
          "@type": "TypeMetadata",
          kind: "object",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [],
          typeName: "CategoryType",
          description: "",
          propertyName: "category",
        },
        {
          "@type": "TypeMetadata",
          kind: "object",
          array: true,
          nullable: false,
          canBeUndefined: false,
          properties: [],
          typeName: "CategoryType",
          description: "",
          propertyName: "categories",
        },
        {
          "@type": "TypeMetadata",
          kind: "number",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [],
          propertyName: "categoryCount",
          description: "",
        },
      ],
      mutations: [
        {
          "@type": "TypeMetadata",
          kind: "model",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [],
          modelName: "PostModel",
          propertyName: "postSave",
          description: "",
          args: {
            "@type": "TypeMetadata",
            kind: "object",
            array: false,
            nullable: false,
            canBeUndefined: false,
            properties: [
              {
                "@type": "TypeMetadata",
                kind: "number",
                array: false,
                nullable: false,
                canBeUndefined: false,
                properties: [],
                propertyName: "id",
              },
              {
                "@type": "TypeMetadata",
                kind: "string",
                array: false,
                nullable: false,
                canBeUndefined: false,
                properties: [],
                propertyName: "name",
              },
            ],
            typeName: "PostInput",
            description: "Simple input for testing purposes.",
          },
        },
        {
          "@type": "TypeMetadata",
          kind: "boolean",
          array: false,
          nullable: false,
          canBeUndefined: false,
          properties: [],
          propertyName: "postRemove",
          description: "",
          args: {
            "@type": "TypeMetadata",
            kind: "object",
            array: false,
            nullable: false,
            canBeUndefined: false,
            properties: [
              {
                "@type": "TypeMetadata",
                kind: "number",
                array: false,
                nullable: false,
                canBeUndefined: false,
                properties: [],
                propertyName: "id",
              },
            ],
          },
        },
        {
          "@type": "TypeMetadata",
          kind: "object",
          array: true,
          nullable: false,
          canBeUndefined: false,
          properties: [
            {
              "@type": "TypeMetadata",
              kind: "number",
              array: false,
              nullable: false,
              canBeUndefined: false,
              properties: [],
              propertyName: "id",
            },
          ],
          propertyName: "categoriesSave",
          description: "",
          args: {
            "@type": "TypeMetadata",
            kind: "object",
            array: true,
            nullable: false,
            canBeUndefined: false,
            properties: [
              {
                "@type": "TypeMetadata",
                kind: "number",
                array: false,
                nullable: false,
                canBeUndefined: false,
                properties: [],
                propertyName: "id",
              },
              {
                "@type": "TypeMetadata",
                kind: "string",
                array: false,
                nullable: false,
                canBeUndefined: false,
                properties: [],
                propertyName: "name",
              },
            ],
            typeName: "CategoryInput",
            description: "Simple input for testing purposes.",
          },
        },
      ],
      subscriptions: [],
    })
  })
})
